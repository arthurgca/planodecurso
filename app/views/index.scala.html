@(planoForm: Form[PlanoDeCurso], catalogoDeDisciplinas: CatalogoDeDisciplinas)

@import helper._

@disciplinaField(field: Field) = {
  <div class="row disciplina @field.value">
    <a href="#" class="close remove" aria-hidden="true">&times;</a>
    @**************************************************************************
     * Play won't apply any data binder when the form has errors, so we need
     * this to ask CatalogoDeDisciplinas for data :(
     **************************************************************************@
    <div class="nome">@catalogoDeDisciplinas.get(field.value.get).getNome()</div>
    <div class="descricao">@catalogoDeDisciplinas.get(field.value.get).getCreditos() créditos</div>
    <input type="hidden" name="@field.name" value="@field.value">
  </div>
}

@periodoGroup(field: Field) = {
  <div id="periodo-@{field("semestre").value}" class="col-md-2 periodo">
    <div class="row sumario">
      <h4>@{field("semestre").value}º Período<br/>
        <small>@field("totalCreditos").value créditos</small></h4>
    </div>

    <input type="hidden" name="@field("semestre").name" value="@field("semestre").value">

    <div class="sortable-list">
      @repeat(field("disciplinas"), min=0) { disciplina =>
        @disciplinaField(disciplina)
      }
    </div>

    <div class="row sumario">
      <h4>@{field("semestre").value}º Período<br/>
        <small>@field("totalCreditos").value créditos</small></h4>
    </div>
  </div>
}

@main("Plano de Curso") {
<div class="container">
  <h2 class="nome-principal">Meu Curso</h2>

  @if(planoForm.hasErrors) {
  <div class="alert alert-danger">
    <strong>Opa!</strong> Corrija esses problemas no seu Plano de Curso:
    <ul>
      @for((key, value) <- planoForm.errors) {
        @for(error <- value) {
          <li>@error.message().toString</li>
        }
      }
    </ul>
  </div>
  }

  @helper.form(action = routes.Application.submit, 'id -> "form") {
  <div id="disciplinas-alocadas">
    <div class="row">
      @repeat(planoForm("periodos"), min=1) { periodo =>
        @periodoGroup(periodo)
      }
    </div>
  </div>
  }

  <h2 class="nome-principal">Disciplinas Ofertadas</h2>

  <div id="disciplinas-ofertadas">
    @for(disciplinasRow <- catalogoDeDisciplinas.getAll().grouped(6)) {
    <div class="row">
      @for(disciplina <- disciplinasRow) {
      <div class="col-md-2">
        <div class="row disciplina @disciplina.getId()">
          <div class="nome">@disciplina.getNome()</div>
          <div class="descricao">@disciplina.getCreditos() Créditos</div>
          <input type="hidden" name="periodos[x].disciplinas[x]" value="@disciplina.getId()">
        </div>
      </div>
      }
    </div>
    }
  </div>
</div>
}
